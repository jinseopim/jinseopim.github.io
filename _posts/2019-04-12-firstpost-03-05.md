---
layout: post
title:  "[ë¹…ë°ì´í„° ì•„í‚¤í…ì²˜ êµ¬ì¶•] (07) Node.js ì—ì„œ ê°œë°œí•˜ê¸° : Dialogflow"
date:   2019-04-13 05:36:23 +0700
categories: [python, codefights]
---

___

__[ëª©ì°¨]__

- [(01) ë¹…ë°ì´í„° ë¶„ì„ ë° ì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ ì„¤ëª…](https://jinseopim.github.io/python/codefights/2019/04/12/firstpost-02.html)
- [(02) ì•„í‚¤í…ì²˜ êµ¬ì„± (ìˆ˜ì§‘/ê°œë°œ ë„êµ¬ ì„¤ì¹˜) : Python](https://jinseopim.github.io/python/codefights/2019/04/12/firstpost-03-00.html)
- [(03) ì•„í‚¤í…ì²˜ êµ¬ì„± (ìˆ˜ì§‘/ê°œë°œ ë„êµ¬ ì„¤ì¹˜) : R/RStudio](https://jinseopim.github.io/r/rstudio/2019/04/12/firstpost-03-01.html)
- [(04) ì•„í‚¤í…ì²˜ êµ¬ì„± (ìˆ˜ì§‘/ê°œë°œ ë„êµ¬ ì„¤ì¹˜) : Node.js/VSCode](https://jinseopim.github.io/python/codefights/2019/04/12/firstpost-03-02.html)
- [(05) ì•„í‚¤í…ì²˜ êµ¬ì„± (ì €ì¥/ë¶„ì„ ë„êµ¬ ì„¤ì¹˜) : Docker, elastic](https://jinseopim.github.io/python/codefights/2019/04/12/firstpost-03-03.html)
- [(06) RStudio ì—ì„œ ê°œë°œí•˜ê¸° : ElasticSearch](https://jinseopim.github.io/python/codefights/2019/04/12/firstpost-03-04.html)
- __[(07) Node.js ì—ì„œ ê°œë°œí•˜ê¸° : Dialogflow](https://jinseopim.github.io/python/codefights/2019/04/12/firstpost-03-05.html)__
- [(08) Python ì—ì„œ ê°œë°œí•˜ê¸°](https://jinseopim.github.io/python/codefights/2019/04/12/firstpost-04.html)
___

## (07) Node.js ì—ì„œ ê°œë°œí•˜ê¸° : Dialogflow
### Dialogflow
**1) ì±—ë´‡ ê°œë…**
- í™”ìì˜ ì˜ë„, ì†ì„±, ë¬¸ë§¥ì„ ë¶„ì„í•˜ì—¬ ì ì ˆí•œ ì‘ë‹µì„ ë³´ëƒ„.
	- ì˜ë„ : Intent
	- ì†ì„± : Entity
	- ë¬¸ë§¥ : Context
		- Intent : ìˆ˜ë¦¬ê°€ ê°€ëŠ¥í• ê¹Œìš”? -> ì–´ëŠë‚ ë¡œ ì˜ˆì•½ì„ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
		- Entity : ë‚´ì¼ ì˜¤í›„ 2ì‹œ ë˜ë‚˜ìš” -> 'ë‚´ì¼', 'ì˜¤í›„ 2ì‹œ'
		- Fulfillment : Web Hook ì²˜ë¦¬ ì§€ì›
		- Context : ë¬´ì—‡ì„ ìœ„í•œ ë‚´ì¼ ì˜¤í›„ 2ì‹œ ì¸ê°€ë¥¼ ì´í•´
		- Event : ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ì›í•˜ëŠ” intent ë¡œ ì´ë™
		- Slot Filling : ë¹ˆ ìŠ¬ë¡¯ì„ ì±„ì›Œë„£ëŠ” ê²ƒì²˜ëŸ¼ ëŒ€í™”ë¥¼ ì§„í–‰(ë°˜ë“œì‹œ í•„ìš”í•œ Entity ë¥¼ ì‰½ê²Œ ì‚¬ìš©ìë¡œë¶€í„° ë°›ìŒ)
		- Training(ì¬í•™ìŠµ) : intent ë§¤í•‘ ê°€ëŠ¥
		- Negative examples : Add this phrase to Default Fallback Intent

**2) Dialogflow** : [https://dialogflow.com/](https://dialogflow.com/)
- íšŒì›ê°€ì… -> ì¸í…íŠ¸ ìƒì„±
![Imgur](https://i.imgur.com/9g0nmQY.png)

- Add follow-up intent -> yes intent ì„ íƒ
![Imgur](https://i.imgur.com/myP4QbA.png)

- Fulfillment ì„¤ì • -> Inline Editor -> ENABLE
![Imgur](https://i.imgur.com/kLVnzwg.png)

- index.js ì‘ì„± (ì•„ë˜ ì½”ë“œ ì‚½ì…)
	- intentëª…ìœ¼ë¡œ callback í•¨ìˆ˜ë¥¼ í˜¸ì¶œ í•˜ëŠ” êµ¬ì¡° ì´ë¯€ë¡œ, ë³¸ì¸ì´ ìƒì„±í•œ intentëª…ìœ¼ë¡œ ìˆ˜ì •í•´ì•¼í•¨.

```python
// See https://github.com/dialogflow/dialogflow-fulfillment-nodejs
// for Dialogflow fulfillment library docs, samples, and to report issues
'use strict';

const functions = require('firebase-functions');
const {WebhookClient} = require('dialogflow-fulfillment');
const {Card, Suggestion} = require('dialogflow-fulfillment');

process.env.DEBUG = 'dialogflow:debug'; // enables lib debugging statements

exports.dialogflowFirebaseFulfillment = functions.https.onRequest((request, response) => {
  const agent = new WebhookClient({ request, response });
  console.log('Dialogflow Request headers: ' + JSON.stringify(request.headers));
  console.log('Dialogflow Request body: ' + JSON.stringify(request.body));

  function welcome(agent) {
    agent.add(`Welcome to my agent!`);
  }

  function fallback(agent) {
    agent.add(`I didn't understand`);
    agent.add(`I'm sorry, can you try again?`);
}

  // // Uncomment and edit to make your own intent handler
  // // uncomment `intentMap.set('your intent name here', yourFunctionHandler);`
  // // below to get this function to be run when a Dialogflow intent is matched
  // function yourFunctionHandler(agent) {
  //   agent.add(`This message is from Dialogflow's Cloud Functions for Firebase editor!`);
  //   agent.add(new Card({
  //       title: `Title: this is a card title`,
  //       imageUrl: 'https://developers.google.com/actions/images/badges/XPM_BADGING_GoogleAssistant_VER.png',
  //       text: `This is the body text of a card.  You can even use line\n  breaks and emoji! ğŸ’`,
  //       buttonText: 'This is a button',
  //       buttonUrl: 'https://assistant.google.com/'
  //     })
  //   );
  //   agent.add(new Suggestion(`Quick Reply`));
  //   agent.add(new Suggestion(`Suggestion`));
  //   agent.setContext({ name: 'weather', lifespan: 2, parameters: { city: 'Rome' }});
  // }

  // // Uncomment and edit to make your own Google Assistant intent handler
  // // uncomment `intentMap.set('your intent name here', googleAssistantHandler);`
  // // below to get this function to be run when a Dialogflow intent is matched
  // function googleAssistantHandler(agent) {
  //   let conv = agent.conv(); // Get Actions on Google library conv instance
  //   conv.ask('Hello from the Actions on Google client library!') // Use Actions on Google library
  //   agent.add(conv); // Add Actions on Google library responses to your agent's response
  // }
  // // See https://github.com/dialogflow/dialogflow-fulfillment-nodejs/tree/master/samples/actions-on-google
  // // for a complete Dialogflow fulfillment library Actions on Google client library v2 integration sample

   // Uncomment and edit to make your own intent handler
   // uncomment `intentMap.set('your intent name here', yourFunctionHandler);`
   // below to get this function to be run when a Dialogflow intent is matched
   function storeFunctionHandler(agent) {
     const allContext = agent.contexts;
     const context = agent.getContext('0001-mv-qst-followup');
     console.log('context : ' + JSON.stringify(allContext));


         // 1. ìœ„ì¹˜ì •ë³´íƒìƒ‰ ê¸°ëŠ¥ì„ êµ¬í˜„í•œë‹¤.
    //  - ì‚¬ìš©ì ip ê¸°ë°˜ìœ¼ë¡œ ìœ„ì¹˜ì •ë³´ë¥¼ íƒìƒ‰í•œë‹¤.
    //  - user ip geolocation node.js

    // 2. í•´ë‹¹ ìœ„ì¹˜ì˜ ë‚ ì”¨ë¥¼ ê²€ìƒ‰í•˜ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•œë‹¤.
    //     - weather node.js

    // 3. ë‚ ì”¨ë¥¼ ë¶„ë¥˜í•œë‹¤.
    //     - ë§‘ìŒ, íë¦¼, ë¹„, ëˆˆ, ì•ˆê°œ
    //     - ì˜¨ë„ : 10ì´ìƒ, ì´í•˜
    //     - ë¯¸ì„¸ë¨¼ì§€ : ë§ë‹¤, ì ë‹¤

    // 4. ë‚ ì”¨/ë°”ì´ì˜¤ë¦¬ë“¬ ì— ì–´ìš¸ë¦¬ëŠ” ì˜í™”ë¥¼ ì„ íƒí•œë‹¤.
    //     - ì˜í™” ì„ íƒ ë°©ë²•
    //         - ëª‡ê°œë§Œ ì„ íƒí•´ì„œ íƒœê¹…ì„ í•´ë†“ëŠ”ë‹¤.
    //         - ë§‘ì€ì˜í™”, íë¦°ì˜í™”, ë¹„ì˜¤ëŠ”ì˜í™”
    //         - http://www.kobis.or.kr/kobisopenapi/homepg/board/findTutorial.do
    //         - ì˜í™”ì •ë³´ ê°€ì ¸ì˜¤ê¸° ê¸°ëŠ¥ node.js
    //         - ì¥ë¥´ë¥¼ ë²”ìœ„ë¥¼ ë‚ ì”¨ ë§¤í•‘ í•  ìˆ˜ ìˆë„ë¡ ë²”ìœ„ë¥¼ ì •í•œë‹¤.
    //         - ì´ë¯¸ì§€ url ëª‡ê°œë§Œ ì°¾ì–´ì„œ movieUrl ë¡œ ë§¤í•‘ ì‹œí‚¨ë‹¤.

    // 5. ë‹µë³€
    //     - ì˜¤ëŠ˜ì˜ ë‚ ì”¨ê°€ ì–´ì©Œê³  ì €ì©Œê³  í•´ì„œ ë‚´ê°€ ì´ëŸ° ì˜í™”ë¥¼ ì¶”ì²œí•´ ì¤„ê»˜.
    //     - ì˜í™” json ì •ë³´ë¥¼ ì¶œë ¥í•œë‹¤.

     //agent.add('ë‚ ì”¨ì— ë”°ë¼ ë°”ì´ì˜¤ë¦¬ë“¬ì— ë”°ë¼ ë„ˆëŠ” ì´ëŸ° ì˜í™”ë¥¼ ì¢‹ì•„ í•  ê²ƒì´ë‹¤..');
     //agent.setContext({ name: 'weather', lifespan: 2, parameters: { city: 'Rome' }});
	agent.add(new Card({
		title: 'Title: ë‚ ì”¨ì— ë”°ë¼ ë°”ì´ì˜¤ë¦¬ë“¬ì— ë”°ë¼ ë„ˆëŠ” ì´ëŸ° ì˜í™”ë¥¼ ì¢‹ì•„ í•  ê²ƒì´ë‹¤.',
		imageUrl: 'http://mblogthumb1.phinf.naver.net/20151203_140/znfvltm7901_1449100668143GJ8bR_PNG/20151203_084840.png?type=w2',
		text: 'This is the body text of a card.  You can even use line\n  breaks and emoji! ğŸ’',
		buttonText: 'This is a button',
		buttonUrl: 'https://assistant.google.com/'
	  })
	);  
   }

   function callAskDate(agent) {
     const context = agent.getContext('0001-mv-qst-followup');
     //agent.setContext("0001-mv-qst-followup");
     //agent.setFollowupEvent({ "name": "ask_date", "parameters":{"productname": context.parameters.productname}, "languageCode": "ko"} );
     // agent.setFollowupEvent({ "name": "ask_date", "parameters":{"productname": context.parameters.productname}} );
     //agent.setFollowupEvent("ask_date");
   }

  // Run the proper function handler based on the matched Dialogflow intent name
  let intentMap = new Map();
  intentMap.set('Default Welcome Intent', welcome);
  intentMap.set('Default Fallback Intent', fallback);
  intentMap.set('0001-mv-qst - yes', storeFunctionHandler);
  // intentMap.set('0001-mv-qst - no', callAskDate);
  // intentMap.set('your intent name here', googleAssistantHandler);
  agent.handleRequest(intentMap);
});
```
<br/><br/>
**[ì°¸ê³ ìë£Œ]**
- Dialogflow : [https://medium.com/@jwlee98/gcp-dialogflow-%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EA%B0%84%EB%8B%A8-%EC%B1%97%EB%B4%87-%EB%A7%8C%EB%93%A4%EA%B8%B0-514ea25e4961](https://medium.com/@jwlee98/gcp-dialogflow-%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EA%B0%84%EB%8B%A8-%EC%B1%97%EB%B4%87-%EB%A7%8C%EB%93%A4%EA%B8%B0-514ea25e4961)
